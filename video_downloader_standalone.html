<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Video Downloader</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #000000;
      --link-color: #0d6efd;
      --button-bg: #e0e0e0;
      --button-text: #000000;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      padding: 2rem;
      transition: background-color 0.4s ease, color 0.4s ease;
    }

    a { color: var(--link-color); }
    button { background-color: var(--button-bg); color: var(--button-text); }

    body.dark-theme {
      --bg-color: #121212;
      --text-color: #ffffff;
      --link-color: #8ab4f8;
      --button-bg: #333333;
      --button-text: #ffffff;
    }

    body.high-contrast-theme {
      --bg-color: #000000;
      --text-color: #ffff00;
      --link-color: #00ffff;
      --button-bg: #000000;
      --button-text: #ffff00;
    }

    body.solarized-theme {
      --bg-color: #fdf6e3;
      --text-color: #657b83;
      --link-color: #268bd2;
      --button-bg: #eee8d5;
      --button-text: #586e75;
    }

    body.minimal-gray-theme {
      --bg-color: #f4f4f4;
      --text-color: #333;
      --link-color: #555;
      --button-bg: #ccc;
      --button-text: #000;
    }

    .tab-content > div { display: none; animation: fadeIn 0.5s ease-in-out; }
    .tab-content > .active { display: block; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .theme-selector {
      position: fixed;
      top: 0.5rem;
      right: 1rem;
      z-index: 999;
    }

    .thumbnail {
      max-width: 100%;
      height: auto;
      margin-bottom: 1rem;
    }

    @media (max-width: 768px) {
      body { padding: 1rem; font-size: 1rem; }
      h2, h4 { font-size: 1.25rem; }
      .theme-selector select { font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <div class="theme-selector">
    <select id="theme-selector" class="form-select form-select-sm">
      <option value="light-theme">Light</option>
      <option value="dark-theme">Dark</option>
      <option value="high-contrast-theme">High Contrast</option>
      <option value="solarized-theme">Solarized</option>
      <option value="minimal-gray-theme">Minimal Gray</option>
    </select>
  </div>

  <div class="container">
    <ul class="nav nav-tabs mb-4" id="navTabs">
      <li class="nav-item"><a class="nav-link active" href="#" data-tab="downloader">Downloader</a></li>
      <li class="nav-item"><a class="nav-link" href="#" data-tab="history">Download History</a></li>
    </ul>

    <div class="tab-content">
      <div id="downloader" class="active">
        <h2>üé¨ Video Downloader</h2>
        <div class="mb-3">
          <label for="videoUrl" class="form-label">Enter Video URL:</label>
          <input type="text" id="videoUrl" class="form-control" placeholder="https://www.youtube.com/watch?v=example"/>
        </div>
        <button id="getInfoBtn" class="btn btn-primary mb-4">Get Info</button>
        <div id="status" class="mb-3 text-danger"></div>
        <div id="videoInfo" style="display: none;">
          <h4 id="videoTitle"></h4>
          <img id="videoThumbnail" class="thumbnail" src="" alt="Thumbnail"/>
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="audioOnly">
            <label class="form-check-label" for="audioOnly">Audio only (MP3)</label>
          </div>
          <div id="formatOptions" class="mb-3"></div>
          <button id="downloadBtn" class="btn btn-success">Download</button>
        </div>
      </div>
      <div id="history">
        <h2>üìú Download History</h2>
        <ul id="historyList" class="list-group"></ul>
      </div>
    </div>
  </div>

  <script>
  const backendUrl = 'https://video-downloader-backend.up.railway.app';

  // Theme logic
  const themeSelector = document.getElementById('theme-selector');
  const savedTheme = localStorage.getItem('theme') || 'light-theme';
  document.body.classList.add(savedTheme);
  themeSelector.value = savedTheme;

  themeSelector.addEventListener('change', function () {
    document.body.classList.remove('light-theme', 'dark-theme', 'high-contrast-theme', 'solarized-theme', 'minimal-gray-theme');
    document.body.classList.add(this.value);
    localStorage.setItem('theme', this.value);
  });

  // Tab switching
  document.querySelectorAll('[data-tab]').forEach(tab => {
    tab.addEventListener('click', e => {
      e.preventDefault();
      document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
      document.querySelectorAll('.tab-content > div').forEach(div => div.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(tab.dataset.tab).classList.add('active');
      if (tab.dataset.tab === 'history') loadHistory();
    });
  });

  async function loadHistory() {
    try {
      const res = await fetch(`${backendUrl}/history`);
      const history = await res.json();
      const list = document.getElementById('historyList');
      list.innerHTML = '';
      if (history.length === 0) {
        list.innerHTML = '<li class="list-group-item">No downloads yet.</li>';
        return;
      }
      history.forEach(item => {
        const li = document.createElement('li');
        li.className = 'list-group-item';
        li.innerHTML = `
          <strong>${item.title || 'Unknown'}</strong><br/>
          Format: ${item.format_id} | Audio: ${item.audio_only ? '‚úî' : '‚ùå'}<br/>
          Date: ${new Date(item.created_at).toLocaleString()}
        `;
        list.appendChild(li);
      });
    } catch (err) {
      document.getElementById('historyList').innerHTML = '<li class="list-group-item text-danger">Error loading history.</li>';
    }
  }

  document.getElementById('getInfoBtn').addEventListener('click', async () => {
    const url = document.getElementById('videoUrl').value.trim();
    const audioOnly = document.getElementById('audioOnly').checked;
    if (!url) {
      document.getElementById('status').textContent = 'Please enter a video URL.';
      return;
    }

    document.getElementById('status').textContent = 'Fetching video info...';
    document.getElementById('videoInfo').style.display = 'none';

    try {
      const response = await fetch(`${backendUrl}/info`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url })
      });

      if (!response.ok) throw new Error('Failed to fetch info');

      const data = await response.json();
      document.getElementById('videoTitle').textContent = data.title;
      document.getElementById('videoThumbnail').src = data.thumbnail;
      const formatOptions = document.getElementById('formatOptions');
      formatOptions.innerHTML = '';

      const sorted = data.formats.filter(f => f.filesize).sort((a, b) => (b.height || 0) - (a.height || 0));
      sorted.forEach(format => {
        const label = `${format.ext.toUpperCase()} ${format.format_note || ''} (${(format.filesize / 1024 / 1024).toFixed(1)} MB)`;
        const opt = document.createElement('div');
        opt.className = 'form-check';
        opt.innerHTML = `
          <input class="form-check-input" type="radio" name="format" id="format${format.format_id}" value="${format.format_id}">
          <label class="form-check-label" for="format${format.format_id}">${label}</label>
        `;
        formatOptions.appendChild(opt);
      });

      document.getElementById('videoInfo').style.display = 'block';
      document.getElementById('status').textContent = '';
    } catch (err) {
      document.getElementById('status').textContent = 'Error: ' + err.message;
    }
  });

  document.getElementById('downloadBtn').addEventListener('click', async () => {
    const url = document.getElementById('videoUrl').value.trim();
    const audioOnly = document.getElementById('audioOnly').checked;
    const selectedFormat = document.querySelector('input[name="format"]:checked');
    if (!selectedFormat) {
      document.getElementById('status').textContent = 'Please select a format.';
      return;
    }

    document.getElementById('status').textContent = 'Starting download...';

    try {
      const response = await fetch(`${backendUrl}/download`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url, format_id: selectedFormat.value, audio_only: audioOnly })
      });

      const result = await response.json();
      if (result.error) throw new Error(result.error);

      document.getElementById('status').textContent = '‚úÖ Download started!';
    } catch (err) {
      document.getElementById('status').textContent = '‚ùå ' + err.message;
    }
  });
</script>
</body>
</html>
